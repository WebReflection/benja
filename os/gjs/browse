#!/usr/bin/env gjs

/*! (C) 2017 Andrea Giammarchi */
  
(function (Gtk, Gdk, WebKit2) {'use strict';
  Gtk.init(null);

  const
    Screen = Gdk.Screen.get_default(),
    window = new Gtk.Window({
      title: 'Benja GTK+',
      type : Gtk.WindowType.TOPLEVEL,
      decorated: false,
      window_position: Gtk.WindowPosition.CENTER
    }),
    webView = new WebKit2.WebView(),
    wvSettings = webView.get_settings(),
    gtkSettings = Gtk.Settings.get_default();
  ;

  [
    'allow-file-access-from-file-urls',
    'enable-webgl',
    'enable-webaudio',
    'enable-accelerated-2d-canvas',
    'enable-write-console-messages-to-stdout'
  ].forEach(function (key) {
    wvSettings.set_property(key, true);
  });

  webView.connect('context-menu', () => true);
  webView.load_uri(ARGV[0] || 'http://localhost:8080/');

  window.set_default_size(
    Screen.get_width(),
    Screen.get_height()
  );
  window.connect('show', () => {
    window.fullscreen();
    Gtk.main();
  });
  window.connect('destroy', () => Gtk.main_quit());
  window.connect('delete_event', () => false);
  window.add(webView);
  window.show_all();
}(
  imports.gi.Gtk,
  imports.gi.Gdk,
  imports.gi.WebKit2
));